<div class="container">
    <div class="row">
      <div class="block block-breadcrumbs">
        <ul>
          <li class="home">
            <a href="/"><i class="fa fa-home"></i></a>
            <span></span>
          </li>
          <li>购物车</li>
        </ul>
      </div>
      <div class="main-page">
        <h1 class="page-title">当前购物状态</h1>
        <div class="page-content page-order">
                <ul class="step">
                    <li class="current-step"><span>01. 商品列表</span></li>
                    <li><span>02. 收货地址</span></li>
                    <li><span>03. 收货方式</span></li>
                    <li><span>04. 支付货款</span></li>
                </ul>
                <div class="heading-counter warning">您有:<span><%= @cart_total_quantity %>件 商品</span>在购物车中 </div>
                <div class="order-detail-content">
                    <table class="cart_summary">
                        <thead>
                            <tr>
                                <th class="cart_product">图片</th>
                                <th>描述</th>
                                <th>状态</th>
                                <th>单价</th>
                                <th>数量</th>
                                <th>总计</th>
                                <th class="action"><i class="fa fa-trash-o"></i></th>
                            </tr>
                        </thead>
                        <tbody>
                    <%@line_items.select{ |x| x.good.present? && x.product.present? }.each do |line_item|%>         
                            <tr id='line_<%=line_item.obj_ident%>'>
                                <td class="cart_product">
                                    <%=link_to good_path(line_item.good.bn),:target=>"_blank" do%>
                                        <%=image_tag line_item.good.medium_pic,:class=>"img-responsive"%>
                                    <%end%>
                                </td>
                                <td class="cart_description">
                                    <p class="product-name">
                                      <%if line_item.good.default_image&&line_item.product.list_pictures.first.blank?%>
                                        <%=link_to line_item.product.name,"/product-"+line_item.good.goods_id.to_s+".html",:target=>"_blank"%>
                                      <%else%>
                                        <%=link_to line_item.product.name,good_path(line_item.good.bn),:target=>"_blank"%>
                                      <%end%>
                                       <span><%=line_item.product.spec_info%></span>                                    
                                    </p>
                                    <small class="cart_ref">
                                        <%line_item.product.custom_spec_values_of(@user).each_with_index do |cus,idx|%>
                                          <%=idx+1%> : <%=cus%> <br />
                                        <%end%>
                                    </small>
                                </td>
                                <td class="cart_avail"><span class="label label-success">现货</span></td>
                                <td class="price"><span>￥<%= format('%.2f',line_item.product.price)%></span></td>
                                <td class="qty">
                                    <!-- <input class="form-control input-sm" type="text" value="1">
                                    <a href="#"><i class="fa fa-caret-up"></i></a>
                                    <a href="#"><i class="fa fa-caret-down"></i></a> -->
                                     <%=select_tag :quantity, options_for_select(1..20,line_item.quantity.to_i || default_value),:class=>"quantity form-control",:'data-url'=>cart_path(line_item.obj_ident),:id=>'cart'%>
                                </td>
                                <td class="price">
                                    <span>￥<%=(line_item.product.price*line_item.quantity)%></span>
                                </td>
                                <td class="action">
                                    <%=link_to "删 除",cart_path(line_item.obj_ident),:class=>"delete btn btn-danger",:remote=>true,:method=>:delete%>
                                </td>
                            </tr>
                            <%end%>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3"><strong>商品总价</strong></td>
                                <td colspan="2"><strong>￥<%= format('%.2f',@cart_total)%></strong></td>
                            </tr>
                        </tfoot>    
                    </table>
                    <div class="cart_navigation">
                        <a class="button" href="/"><i class="fa fa-angle-left"></i> 继续购物 </a>
                        <a class="button pull-right" href="/orders/new">安全结算 <i class="fa fa-angle-right"></i></a>
                    </div>
                </div>
            </div>
      </div>
    </div>
  </div>

<script type="text/javascript">
      $(window.document).find(".cart-number").text("(<%=@cart_total_quantity%>)");
</script>
